/*! For license information please see main.56a8c394daf19ce8cf23.js.LICENSE.txt */
(()=>{"use strict";var e,t={121:(e,t,n)=>{var r={};n.r(r);var a={};function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach(function(t){c(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function c(e,t,n){return(t=f(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return l(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,f(r.key),r)}}function f(e){var t=function(e){if("object"!=i(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==i(t)?t:t+""}function p(e,t,n){v(e,t),t.set(e,n)}function v(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function y(e,t){return e.get(m(e,t))}function h(e,t,n){return e.set(m(e,t),n),n}function m(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}n.r(a);var b=new WeakMap,g=new WeakMap,w=new WeakSet;function S(){return{currentUser:null,users:{},ui:{recipient:"",messageText:"",encryptKey:"",encryptKey2:"",securityLevel:"encrypted",privacyLevel:"private",persistenceLevel:"permanent",networkEnabled:!1,modal:null,commandInput:"",commandResult:"",isRecording:!1,attachedFile:null,confirmDialog:null}}}function E(e,t){var n=this;y(g,this).forEach(function(r){try{r({path:e,value:t,state:m(w,n,O).call(n,y(b,n))})}catch(e){console.error("Listener error:",e)}})}function O(e){var t=this;if(null===e||"object"!==i(e))return e;if(e instanceof Date)return new Date(e);if(e instanceof Array)return e.map(function(e){return m(w,t,O).call(t,e)});var n={};for(var r in e)e.hasOwnProperty(r)&&(n[r]=m(w,this,O).call(this,e[r]));return n}function T(e){var t={};for(var n in e){var r=e[n];t[n]={username:r.username,passphraseHash:r.passphraseHash,publicKey:r.publicKey,privateKey:r.privateKey,friends:r.friends||[],groups:r.groups||[],messages:(r.messages||[]).map(function(e){var t={id:e.id,from:e.from,to:e.to,message:e.message,security:e.security,privacy:e.privacy,persistence:e.persistence,timestamp:e.timestamp,read:e.read,destructed:e.destructed,encrypted:e.encrypted,doubleEncrypted:e.doubleEncrypted,selfDestruct:e.selfDestruct,attachedFile:e.attachedFile};return e.attachedFileData&&(t.attachedFileData={name:e.attachedFileData.name,type:e.attachedFileData.type,size:e.attachedFileData.size,stegoMetadata:e.attachedFileData.stegoMetadata,data:e.attachedFileData.stegoMetadata?e.attachedFileData.data:void 0}),t}),friendRequests:r.friendRequests||[],groupInvites:r.groupInvites||[],deadDrops:r.deadDrops||[],createdAt:r.createdAt}}return t}const k=new(function(){return e=function e(){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),v(this,t=w),t.add(this),p(this,b,void 0),p(this,g,void 0),h(b,this,m(w,this,S).call(this)),h(g,this,new Set)},(t=[{key:"getState",value:function(e){if(!e)return m(w,this,O).call(this,y(b,this));var t,n=e.split("."),r=y(b,this),a=u(n);try{for(a.s();!(t=a.n()).done;){var i,o=t.value;r=null===(i=r)||void 0===i?void 0:i[o]}}catch(e){a.e(e)}finally{a.f()}return m(w,this,O).call(this,r)}},{key:"setState",value:function(e,t){var n,r=e.split("."),a=r.pop(),i=y(b,this),o=u(r);try{for(o.s();!(n=o.n()).done;){var s=n.value;i[s]||(i[s]={}),i=i[s]}}catch(e){o.e(e)}finally{o.f()}return i[a]=t,m(w,this,E).call(this,e,t),!0}},{key:"subscribe",value:function(e){var t=this;return y(g,this).add(e),function(){return y(g,t).delete(e)}}},{key:"persist",value:function(){try{var e={users:m(w,this,T).call(this,y(b,this).users),timestamp:(new Date).toISOString()},t=JSON.stringify(e),n=encodeURIComponent(t);localStorage.setItem("fw_secure_data",n),console.log("✓ State saved")}catch(e){console.error("Save failed:",e.message),localStorage.removeItem("fw_secure_data")}}},{key:"restore",value:function(){try{var e=localStorage.getItem("fw_secure_data");if(!e)return void console.log("No saved data");var t=decodeURIComponent(e),n=JSON.parse(t);null!=n&&n.users&&(y(b,this).users=s(s({},y(b,this).users),n.users),console.log("✓ State restored"))}catch(e){console.error("Restore failed:",e.message),localStorage.removeItem("fw_secure_data")}}},{key:"clearAll",value:function(){localStorage.removeItem("fw_secure_data"),h(b,this,m(w,this,S).call(this)),console.log("✓ Data cleared")}}])&&d(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}());var P=function(e,t,n){var r=document.createElement(e);return t&&(r.className=t),n&&(r.textContent=n),r},j=function(e){return new Date(e).toLocaleTimeString()};function D(e){return D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},D(e)}function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach(function(t){R(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function R(e,t,n){return(t=F(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function I(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function i(n,r,a,i){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return C(u,"_invoke",function(n,r,a){var i,s,c,u=0,l=a||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return i=t,s=0,c=e,f.n=n,o}};function p(n,r){for(s=n,c=r,t=0;!d&&u&&!a&&t<l.length;t++){var a,i=l[t],p=f.p,v=i[2];n>3?(a=v===r)&&(c=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=e):i[0]<=p&&((a=n<2&&p<i[1])?(s=0,f.v=r,f.n=i[1]):p<v&&(a=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,f.n=v,s=0))}if(a||n>1)return o;throw d=!0,r}return function(a,l,v){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,v),s=l,c=v;(t=s<2?e:c)||!d;){i||(s?s<3?(s>1&&(f.n=-1),p(s,c)):f.n=c:f.v=c);try{if(u=2,i){if(s||(a="next"),t=i[a]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=i.return)&&t.call(i),s<2&&(c=TypeError("The iterator does not provide a '"+a+"' method"),s=1);i=e}else if((t=(d=f.n<0)?c:n.call(r,f))!==o)break}catch(t){i=e,s=1,c=t}finally{u=1}}return{value:t,done:d}}}(n,a,i),!0),u}var o={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(C(t={},r,function(){return this}),t),d=u.prototype=s.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,C(e,a,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=u,C(d,"constructor",u),C(u,"constructor",c),c.displayName="GeneratorFunction",C(u,a,"GeneratorFunction"),C(d),C(d,a,"Generator"),C(d,r,function(){return this}),C(d,"toString",function(){return"[object Generator]"}),(I=function(){return{w:i,m:f}})()}function C(e,t,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}C=function(e,t,n,r){function i(t,n){C(e,t,function(e){return this._invoke(t,n,e)})}t?a?a(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},C(e,t,n,r)}function M(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function x(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var i=e.apply(t,n);function o(e){M(i,r,a,o,s,"next",e)}function s(e){M(i,r,a,o,s,"throw",e)}o(void 0)})}}function N(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,F(r.key),r)}}function F(e){var t=function(e){if("object"!=D(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=D(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==D(t)?t:t+""}const K=new(function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.subtle=window.crypto.subtle,this.SALT_LENGTH=16,this.IV_LENGTH=12,this.KEY_LENGTH=256,this.ITERATIONS=6e5},t=[{key:"getRandomBytes",value:function(e){return window.crypto.getRandomValues(new Uint8Array(e))}},{key:"deriveKey",value:(s=x(I().m(function e(t){var n,r,a,i,o=arguments;return I().w(function(e){for(;;)switch(e.n){case 0:return(n=o.length>1&&void 0!==o[1]?o[1]:null)||(n=this.getRandomBytes(this.SALT_LENGTH)),r=(new TextEncoder).encode(t),e.n=1,this.subtle.importKey("raw",r,"PBKDF2",!1,["deriveKey"]);case 1:return a=e.v,e.n=2,this.subtle.deriveKey({name:"PBKDF2",salt:n,iterations:this.ITERATIONS,hash:"SHA-256"},a,{name:"AES-GCM",length:this.KEY_LENGTH},!0,["encrypt","decrypt"]);case 2:return i=e.v,e.a(2,{key:i,salt:n})}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"encrypt",value:(o=x(I().m(function e(t,n){var r,a,i,o,s,c,u,l;return I().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this.deriveKey(n);case 1:return r=e.v,a=r.key,i=r.salt,o=this.getRandomBytes(this.IV_LENGTH),s=(new TextEncoder).encode(t),e.n=2,this.subtle.encrypt({name:"AES-GCM",iv:o,tagLength:128},a,s);case 2:return c=e.v,(u=new Uint8Array(i.length+o.length+c.byteLength)).set(i,0),u.set(o,i.length),u.set(new Uint8Array(c),i.length+o.length),e.a(2,{encrypted:this.arrayBufferToBase64(u),timestamp:Date.now(),algorithm:"AES-256-GCM",iterations:this.ITERATIONS});case 3:throw e.p=3,l=e.v,new Error("Encryption failed: ".concat(l.message));case 4:return e.a(2)}},e,this,[[0,3]])})),function(e,t){return o.apply(this,arguments)})},{key:"decrypt",value:(i=x(I().m(function e(t,n){var r,a,i,o,s,c,u;return I().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,r=this.base64ToArrayBuffer("string"==typeof t?t:t.encrypted),a=r.slice(0,this.SALT_LENGTH),i=r.slice(this.SALT_LENGTH,this.SALT_LENGTH+this.IV_LENGTH),o=r.slice(this.SALT_LENGTH+this.IV_LENGTH),e.n=1,this.deriveKey(n,a);case 1:return s=e.v,c=s.key,e.n=2,this.subtle.decrypt({name:"AES-GCM",iv:i,tagLength:128},c,o);case 2:return u=e.v,e.a(2,(new TextDecoder).decode(u));case 3:throw e.p=3,e.v,new Error("Decryption failed: Invalid password or corrupted data");case 4:return e.a(2)}},e,this,[[0,3]])})),function(e,t){return i.apply(this,arguments)})},{key:"doubleEncrypt",value:(a=x(I().m(function e(t,n,r){var a,i;return I().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.encrypt(t,n);case 1:return a=e.v,e.n=2,this.encrypt(a.encrypted,r);case 2:return i=e.v,e.a(2,A(A({},i),{},{layers:2,algorithm:"2DE-AES-256-GCM"}))}},e,this)})),function(e,t,n){return a.apply(this,arguments)})},{key:"doubleDecrypt",value:(r=x(I().m(function e(t,n,r){var a;return I().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.decrypt(t,r);case 1:return a=e.v,e.n=2,this.decrypt(a,n);case 2:return e.a(2,e.v)}},e,this)})),function(e,t,n){return r.apply(this,arguments)})},{key:"generateSecurePassword",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,t=this.getRandomBytes(e);return Array.from(t).map(function(e){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()_+-=[]{}|;:,.<>?"[e%88]}).join("")}},{key:"hash",value:(n=x(I().m(function e(t){var n,r;return I().w(function(e){for(;;)switch(e.n){case 0:return n=(new TextEncoder).encode(t),e.n=1,this.subtle.digest("SHA-256",n);case 1:return r=e.v,e.a(2,this.arrayBufferToBase64(new Uint8Array(r)))}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"arrayBufferToBase64",value:function(e){for(var t=new Uint8Array(e),n="",r=0;r<t.length;r++)n+=String.fromCharCode(t[r]);return btoa(n)}},{key:"base64ToArrayBuffer",value:function(e){for(var t=atob(e),n=new Uint8Array(t.length),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n}}],t&&N(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r,a,i,o,s}());function U(e){return U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},U(e)}function G(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function i(n,r,a,i){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return _(u,"_invoke",function(n,r,a){var i,s,c,u=0,l=a||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return i=t,s=0,c=e,f.n=n,o}};function p(n,r){for(s=n,c=r,t=0;!d&&u&&!a&&t<l.length;t++){var a,i=l[t],p=f.p,v=i[2];n>3?(a=v===r)&&(c=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=e):i[0]<=p&&((a=n<2&&p<i[1])?(s=0,f.v=r,f.n=i[1]):p<v&&(a=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,f.n=v,s=0))}if(a||n>1)return o;throw d=!0,r}return function(a,l,v){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,v),s=l,c=v;(t=s<2?e:c)||!d;){i||(s?s<3?(s>1&&(f.n=-1),p(s,c)):f.n=c:f.v=c);try{if(u=2,i){if(s||(a="next"),t=i[a]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=i.return)&&t.call(i),s<2&&(c=TypeError("The iterator does not provide a '"+a+"' method"),s=1);i=e}else if((t=(d=f.n<0)?c:n.call(r,f))!==o)break}catch(t){i=e,s=1,c=t}finally{u=1}}return{value:t,done:d}}}(n,a,i),!0),u}var o={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(_(t={},r,function(){return this}),t),d=u.prototype=s.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,_(e,a,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=u,_(d,"constructor",u),_(u,"constructor",c),c.displayName="GeneratorFunction",_(u,a,"GeneratorFunction"),_(d),_(d,a,"Generator"),_(d,r,function(){return this}),_(d,"toString",function(){return"[object Generator]"}),(G=function(){return{w:i,m:f}})()}function _(e,t,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}_=function(e,t,n,r){function i(t,n){_(e,t,function(e){return this._invoke(t,n,e)})}t?a?a(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},_(e,t,n,r)}function B(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function H(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var i=e.apply(t,n);function o(e){B(i,r,a,o,s,"next",e)}function s(e){B(i,r,a,o,s,"throw",e)}o(void 0)})}}function Y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,W(r.key),r)}}function W(e){var t=function(e){if("object"!=U(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=U(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==U(t)?t:t+""}var q=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.container=t,this.state=n,this.render()},t=[{key:"render",value:function(){this.container.innerHTML='\n      <div class="login-terminal">\n        <div class="terminal-window">\n          <div class="terminal-header-bar">\n            <div class="login-branding">\n              <div class="ascii-logo">4WORD</div>\n              <div class="login-subtitle">Secure • Encrypted • Private</div>\n              <div class="login-version">v2.0</div>\n            </div>\n          </div>\n          \n          <div class="terminal-body">\n            <form class="login-form-terminal" id="loginForm">\n              <div class="form-field-terminal">\n                <label class="field-label">Username</label>\n                <div class="input-wrapper">\n                  <span class="input-prefix">@</span>\n                  <input \n                    type="text" \n                    id="username" \n                    class="terminal-input-field" \n                    placeholder="username"\n                    autocomplete="username"\n                    autocapitalize="off"\n                  />\n                </div>\n              </div>\n\n              <div class="form-field-terminal">\n                <label class="field-label">Passphrase</label>\n                <div class="input-wrapper">\n                  <span class="input-prefix">🔑</span>\n                  <input \n                    type="password" \n                    id="passphrase" \n                    class="terminal-input-field" \n                    placeholder="••••••••"\n                    autocomplete="current-password"\n                  />\n                </div>\n              </div>\n\n              <div class="action-buttons-terminal">\n                <button type="submit" class="btn-terminal-action primary">\n                  <span class="btn-icon">▶</span> Login\n                </button>\n                <button type="button" class="btn-terminal-action secondary" id="registerBtn">\n                  <span class="btn-icon">+</span> Register\n                </button>\n              </div>\n\n              <div class="demo-info">\n                <div class="info-header">DEMO ACCOUNTS</div>\n                <div class="demo-account">@alice : password123</div>\n                <div class="demo-account">@bob : password123</div>\n              </div>\n            </form>\n\n            <div class="security-notice">\n              <div class="notice-line">AES-256 Encryption Enabled</div>\n              <div class="notice-line">Zero-Knowledge Architecture</div>\n              <div class="notice-line">End-to-End Encrypted</div>\n            </div>\n          </div>\n        </div>\n      </div>\n    ',this.attachEventListeners()}},{key:"attachEventListeners",value:function(){var e=this,t=document.getElementById("loginForm"),n=document.getElementById("registerBtn");t.addEventListener("submit",function(t){t.preventDefault(),e.handleLogin()}),n.addEventListener("click",function(t){t.preventDefault(),e.handleRegister()})}},{key:"handleLogin",value:(a=H(G().m(function e(){var t,n,a,i,o,s,c=this;return G().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=document.getElementById("username").value.trim(),n=document.getElementById("passphrase").value,a=t.startsWith("@")?t:"@"+t,i=this.state.getState("users"),o=i[a]){e.n=1;break}return this.showError("USER NOT FOUND"),e.a(2);case 1:if("password123"!==n||"@alice"!==a&&"@bob"!==a){e.n=2;break}return this.showSuccess("LOGIN SUCCESSFUL"),setTimeout(function(){c.state.setState("currentUser",o)},500),e.a(2);case 2:if(e.p=2,!r.EncryptionService.verifyPassword(n,o.passphraseHash)){e.n=3;break}return this.showSuccess("LOGIN SUCCESSFUL"),setTimeout(function(){c.state.setState("currentUser",o)},500),e.a(2);case 3:e.n=5;break;case 4:e.p=4,s=e.v,console.error("Password verification error:",s);case 5:this.showError("INVALID PASSPHRASE");case 6:return e.a(2)}},e,this,[[2,4]])})),function(){return a.apply(this,arguments)})},{key:"handleRegister",value:(n=H(G().m(function e(){var t,n,a,i,o,s,c;return G().w(function(e){for(;;)switch(e.n){case 0:if(t=document.getElementById("username").value.trim(),n=document.getElementById("passphrase").value,!((a=t.startsWith("@")?t:"@"+t).length<3)){e.n=1;break}return this.showError("USERNAME TOO SHORT (MIN 3 CHARS)"),e.a(2);case 1:if(!(n.length<6)){e.n=2;break}return this.showError("PASSPHRASE TOO WEAK (MIN 6 CHARS)"),e.a(2);case 2:if(!(i=this.state.getState("users"))[a]){e.n=3;break}return this.showError("USERNAME ALREADY EXISTS"),e.a(2);case 3:return this.showSuccess("GENERATING KEYPAIR..."),e.n=4,r.EncryptionService.generateSimpleKeyPair();case 4:o=e.v,s=r.EncryptionService.hashPassword(n),c={username:a,passphraseHash:s.combined,publicKey:o.publicKey,privateKey:o.privateKey,friends:[],groups:[],messages:[],friendRequests:[],groupInvites:[],deadDrops:[],createdAt:(new Date).toISOString()},i[a]=c,this.state.setState("users",i),this.state.persist(),this.showSuccess("ACCOUNT CREATED: ".concat(a)),setTimeout(function(){document.getElementById("username").value="",document.getElementById("passphrase").value=""},1500);case 5:return e.a(2)}},e,this)})),function(){return n.apply(this,arguments)})},{key:"showError",value:function(e){var t=P("div","terminal-alert error");t.innerHTML='\n      <div class="alert-icon">✗</div>\n      <div class="alert-message">'.concat(e,"</div>\n    ");var n=document.getElementById("loginForm"),r=n.querySelector(".terminal-alert");r&&r.remove(),n.insertBefore(t,n.firstChild),setTimeout(function(){return t.remove()},3e3)}},{key:"showSuccess",value:function(e){var t=P("div","terminal-alert success");t.innerHTML='\n      <div class="alert-icon">✓</div>\n      <div class="alert-message">'.concat(e,"</div>\n    ");var n=document.getElementById("loginForm"),r=n.querySelector(".terminal-alert");r&&r.remove(),n.insertBefore(t,n.firstChild),setTimeout(function(){return t.remove()},3e3)}}],t&&Y(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,a}();function $(e){return $="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$(e)}function z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,V(r.key),r)}}function V(e){var t=function(e){if("object"!=$(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=$(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==$(t)?t:t+""}function Q(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var J=new WeakSet,X=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}(this,J),this.state=t},(t=[{key:"execute",value:function(e){if(!e.startsWith("$"))return"ERROR: Commands must start with $";var t=e.trim().split(" "),n=t[0],r=t.slice(1),a=this.state.getState("currentUser"),i=this.state.getState("users");switch(n){case"$help":return Q(J,this,Z).call(this);case"$showFriends":return Q(J,this,ee).call(this,a);case"$status":return Q(J,this,te).call(this,a);case"$users":return Q(J,this,ne).call(this,i);case"$clear":return Q(J,this,re).call(this);case"$pubkey":return Q(J,this,ae).call(this,a,r[0]);case"$encrypt":return Q(J,this,ie).call(this,r);case"$decrypt":return Q(J,this,oe).call(this,r);case"$ping":return Q(J,this,se).call(this,r[0],i);case"$whoami":return Q(J,this,ce).call(this,a);default:return"ERROR: Unknown command '".concat(n,"'\nType $help for available commands")}}}])&&z(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function Z(){return"╔═══════════════════════════════════════╗\n║         AVAILABLE COMMANDS            ║\n╚═══════════════════════════════════════╝\n\nSYSTEM:\n  $help              Show this help\n  $whoami            Display current user\n  $status            Account statistics\n  $clear             Clear terminal output\n\nNETWORK:\n  $users             List all users\n  $ping <user>       Check user status\n  $showFriends       Show friend list\n\nCRYPTO:\n  $pubkey [user]     Show public key\n  $encrypt <msg>     Encrypt message\n  $decrypt <msg>     Decrypt message\n\nTYPE: $<command> [args]"}function ee(e){return e.friends&&0!==e.friends.length?"╔════════════════════════════════╗\n║        FRIEND LIST             ║\n╚════════════════════════════════╝\n\n".concat(e.friends.map(function(e,t){return"  [".concat(t+1,"] ").concat(e)}).join("\n"),"\n\nTOTAL: ").concat(e.friends.length," friend(s)"):"╔════════════════╗\n║  NO FRIENDS    ║\n╚════════════════╝\n\nYour friend list is empty."}function te(e){var t=e.messages.filter(function(t){return!t.read&&(t.to===e.username||"@everyone"===t.to)}).length,n=e.messages.filter(function(t){return t.from===e.username}).length,r=e.messages.filter(function(t){return t.to===e.username}).length;return"╔════════════════════════════════╗\n║      ACCOUNT STATUS            ║\n╚════════════════════════════════╝\n\nUSER:       ".concat(e.username,"\nCREATED:    ").concat(new Date(e.createdAt).toLocaleDateString(),"\n\nMESSAGES:\n  Total:    ").concat(e.messages.length,"\n  Sent:     ").concat(n,"\n  Received: ").concat(r,"\n  Unread:   ").concat(t,"\n\nNETWORK:\n  Friends:  ").concat(e.friends.length,"\n  Groups:   ").concat(e.groups.length,"\n\nSECURITY:\n  Keypair:  ✓ ACTIVE\n  PubKey:   ").concat(e.publicKey?e.publicKey.slice(0,16)+"...":"N/A")}function ne(e){var t=Object.keys(e);return"╔════════════════════════════════╗\n║      REGISTERED USERS          ║\n╚════════════════════════════════╝\n\n".concat(t.map(function(e,t){return"  [".concat(t+1,"] ").concat(e)}).join("\n"),"\n\nTOTAL: ").concat(t.length," user(s) online")}function re(){return this.state.setState("ui.commandResult",""),""}function ae(e,t){if(!t)return"YOUR PUBLIC KEY:\n".concat(e.publicKey||"N/A","\n\nUSE: $pubkey <username> to view others");var n=this.state.getState("users")[t.startsWith("@")?t:"@"+t];return n?"PUBLIC KEY FOR ".concat(n.username,":\n").concat(n.publicKey||"N/A"):"ERROR: User '".concat(t,"' not found")}function ie(e){if(0===e.length)return"USAGE: $encrypt <message>\nEncrypts message with your private key";var t=e.join(" "),n=btoa(t);return"ENCRYPTED:\n".concat(n,"\n\nOriginal length: ").concat(t.length,"\nEncrypted length: ").concat(n.length)}function oe(e){if(0===e.length)return"USAGE: $decrypt <encrypted_message>";try{var t=e[0],n=atob(t);return"DECRYPTED:\n".concat(n)}catch(e){return"ERROR: Invalid encrypted message"}}function se(e,t){if(!e)return"USAGE: $ping <username>";var n=e.startsWith("@")?e:"@"+e;if(!t[n])return"ERROR: User '".concat(e,"' not found");var r=Math.floor(100*Math.random())+10;return"PING ".concat(n,"...\n\nRESPONSE: ✓ OK\nLATENCY: ").concat(r,"ms\nSTATUS: ONLINE")}function ce(e){return"╔════════════════════════════════╗\n║         IDENTITY               ║\n╚════════════════════════════════╝\n\nUSERNAME:  ".concat(e.username,"\nPUBKEY:    ").concat(e.publicKey?e.publicKey.slice(0,32)+"...":"N/A","\nCREATED:   ").concat(new Date(e.createdAt).toLocaleString(),"\nFRIENDS:   ").concat(e.friends.length,"\nMESSAGES:  ").concat(e.messages.length)}var ue=n(583);function le(e){return le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},le(e)}function de(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function i(n,r,a,i){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return fe(u,"_invoke",function(n,r,a){var i,s,c,u=0,l=a||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return i=t,s=0,c=e,f.n=n,o}};function p(n,r){for(s=n,c=r,t=0;!d&&u&&!a&&t<l.length;t++){var a,i=l[t],p=f.p,v=i[2];n>3?(a=v===r)&&(c=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=e):i[0]<=p&&((a=n<2&&p<i[1])?(s=0,f.v=r,f.n=i[1]):p<v&&(a=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,f.n=v,s=0))}if(a||n>1)return o;throw d=!0,r}return function(a,l,v){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,v),s=l,c=v;(t=s<2?e:c)||!d;){i||(s?s<3?(s>1&&(f.n=-1),p(s,c)):f.n=c:f.v=c);try{if(u=2,i){if(s||(a="next"),t=i[a]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=i.return)&&t.call(i),s<2&&(c=TypeError("The iterator does not provide a '"+a+"' method"),s=1);i=e}else if((t=(d=f.n<0)?c:n.call(r,f))!==o)break}catch(t){i=e,s=1,c=t}finally{u=1}}return{value:t,done:d}}}(n,a,i),!0),u}var o={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(fe(t={},r,function(){return this}),t),d=u.prototype=s.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,fe(e,a,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=u,fe(d,"constructor",u),fe(u,"constructor",c),c.displayName="GeneratorFunction",fe(u,a,"GeneratorFunction"),fe(d),fe(d,a,"Generator"),fe(d,r,function(){return this}),fe(d,"toString",function(){return"[object Generator]"}),(de=function(){return{w:i,m:f}})()}function fe(e,t,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}fe=function(e,t,n,r){function i(t,n){fe(e,t,function(e){return this._invoke(t,n,e)})}t?a?a(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},fe(e,t,n,r)}function pe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ve(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pe(Object(n),!0).forEach(function(t){ye(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pe(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function ye(e,t,n){return(t=ge(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function he(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function me(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var i=e.apply(t,n);function o(e){he(i,r,a,o,s,"next",e)}function s(e){he(i,r,a,o,s,"throw",e)}o(void 0)})}}function be(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ge(r.key),r)}}function ge(e){var t=function(e){if("object"!=le(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=le(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==le(t)?t:t+""}var we=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},t=[{key:"generate",value:(r=me(de().m(function e(t){var n,r,a,i=arguments;return de().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=ve({errorCorrectionLevel:"H",type:"image/png",quality:.95,margin:1,color:{dark:"#00ff00",light:"#000000"},width:300},i.length>1&&void 0!==i[1]?i[1]:{}),e.p=1,e.n=2,ue.toDataURL(t,n);case 2:return r=e.v,e.a(2,r);case 3:return e.p=3,a=e.v,console.error("QR generation failed:",a),e.a(2,null)}},e,null,[[1,3]])})),function(e){return r.apply(this,arguments)})},{key:"generateToCanvas",value:(n=me(de().m(function e(t,n){var r,a,i=arguments;return de().w(function(e){for(;;)switch(e.p=e.n){case 0:return r=ve({errorCorrectionLevel:"H",margin:1,color:{dark:"#00ff00",light:"#000000"},width:300},i.length>2&&void 0!==i[2]?i[2]:{}),e.p=1,e.n=2,ue.toCanvas(t,n,r);case 2:e.n=4;break;case 3:e.p=3,a=e.v,console.error("QR canvas generation failed:",a);case 4:return e.a(2)}},e,null,[[1,3]])})),function(e,t){return n.apply(this,arguments)})}],t&&be(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r}();function Se(e){return Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Se(e)}function Ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ee(Object(n),!0).forEach(function(t){Te(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ee(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Te(e,t,n){return(t=Pe(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ke(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Pe(r.key),r)}}function Pe(e){var t=function(e){if("object"!=Se(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Se(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Se(t)?t:t+""}var je=function(){return e=function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.container=t,this.state=n,this.messages=r,this.selectedMsg=null,this.decryptKey="",this.decryptKey2="",this.viewingDestruct=null,this.countdown=null,this.countdownInterval=null,this.render(),this.attachEventListeners()},t=[{key:"render",value:function(){this.container.innerHTML='\n      <div class="inbox-terminal">\n        <div class="inbox-list-terminal">\n          '.concat(this.renderMessagesList(),'\n        </div>\n        <div class="inbox-details-terminal">\n          ').concat(this.renderMessageDetails(),"\n        </div>\n      </div>\n    ")}},{key:"renderMessagesList",value:function(){var e=this;return 0===this.messages.length?'\n        <div class="inbox-empty-terminal">\n          <p>NO MESSAGES</p>\n        </div>\n      ':'\n      <div class="message-list-scroll">\n        '.concat(this.messages.map(function(t,n){var r;return'\n          <div class="msg-list-item '.concat((null===(r=e.selectedMsg)||void 0===r?void 0:r.id)===t.id?"active":"",'" data-msg-idx="').concat(n,'">\n            <div class="msg-list-header">\n              <span class="msg-from">').concat(t.from,'</span>\n              <span class="msg-time">').concat(j(t.timestamp),'</span>\n            </div>\n            <div class="msg-list-preview">\n              ').concat(t.destructed?"💥 DESTROYED":t.selfDestruct?"💣 SELF-DESTRUCT":t.message.slice(0,40)+"...",'\n            </div>\n            <div class="msg-list-badges">\n              ').concat(t.read?"":'<span class="badge-mini unread">NEW</span>',"\n              ").concat(t.selfDestruct&&!t.destructed?'<span class="badge-mini destruct">💣</span>':"","\n              ").concat(t.encrypted?'<span class="badge-mini encrypted">🔒</span>':"","\n            </div>\n          </div>\n        ")}).join(""),"\n      </div>\n    ")}},{key:"renderMessageDetails",value:function(){if(!this.selectedMsg)return'\n        <div class="details-empty-terminal">\n          <p>SELECT A MESSAGE TO VIEW</p>\n        </div>\n      ';var e,t=this.selectedMsg,n=this.state.getState("currentUser");return t.destructed&&this.viewingDestruct!==t.id?'\n        <div class="msg-destroyed-terminal">\n          <div class="destroyed-icon">💥</div>\n          <div class="destroyed-title">MESSAGE DESTROYED</div>\n          <div class="destroyed-text">This transmission has been permanently erased</div>\n        </div>\n      ':'\n      <div class="msg-details-terminal">\n        <div class="details-header">MESSAGE DETAILS</div>\n        \n        <div class="details-meta-grid">\n          <div class="meta-row">\n            <span class="meta-key">FROM:</span>\n            <span class="meta-val">'.concat(t.from,'</span>\n          </div>\n          <div class="meta-row">\n            <span class="meta-key">TO:</span>\n            <span class="meta-val">').concat(t.to,'</span>\n          </div>\n          <div class="meta-row">\n            <span class="meta-key">TIME:</span>\n            <span class="meta-val">').concat((e=t.timestamp,new Date(e).toLocaleString()),'</span>\n          </div>\n          <div class="meta-row">\n            <span class="meta-key">SEC:</span>\n            <span class="meta-val">').concat(t.security?t.security.toUpperCase():"OPEN","</span>\n          </div>\n        </div>\n\n        ").concat(t.encrypted?'\n          <div class="decrypt-section-terminal">\n            <label class="decrypt-label">DECRYPTION KEY:</label>\n            <input \n              type="password" \n              id="decryptKeyInput" \n              class="decrypt-input" \n              placeholder="enter.key"\n              value="'.concat(this.decryptKey,'"\n              ').concat(this.viewingDestruct===t.id?"disabled":"","\n            />\n            ").concat(t.doubleEncrypted?'\n              <label class="decrypt-label">SECONDARY KEY:</label>\n              <input \n                type="password" \n                id="decryptKey2Input" \n                class="decrypt-input" \n                placeholder="enter.key2"\n                value="'.concat(this.decryptKey2,'"\n                ').concat(this.viewingDestruct===t.id?"disabled":"","\n              />\n            "):"","\n          </div>\n        "):"","\n\n        ").concat(t.selfDestruct&&!t.destructed&&this.viewingDestruct!==t.id?'\n          <div class="self-destruct-box">\n            <div class="destruct-warning">⚠ SELF-DESTRUCT MESSAGE ⚠</div>\n            <div class="destruct-text">This message will auto-erase 30 seconds after viewing</div>\n            '.concat(t.encrypted&&(!this.decryptKey||t.doubleEncrypted&&!this.decryptKey2)?'<div class="destruct-notice">⚠ ENTER DECRYPTION KEY(S) FIRST</div>':"",'\n            <button \n              class="btn-destruct" \n              id="viewDestructBtn"\n              ').concat(t.encrypted&&(!this.decryptKey||t.doubleEncrypted&&!this.decryptKey2)?"disabled":"","\n            >\n              👁 VIEW & START COUNTDOWN\n            </button>\n          </div>\n        "):"","\n\n        ").concat(this.viewingDestruct!==t.id&&t.selfDestruct?"":"\n          ".concat(t.attachedFileData?this.renderAttachment(t.attachedFileData):"",'\n\n          <div class="msg-content-box">\n            <div class="content-header">MESSAGE CONTENT:</div>\n            <div class="content-body">\n              ').concat(this.getDecryptedMessage(t,n),"\n            </div>\n          </div>\n\n          ").concat(this.viewingDestruct===t.id&&null!==this.countdown?'\n            <div class="countdown-box-bottom">\n              <div class="countdown-info">\n                <div class="countdown-timer-large">'.concat(this.countdown,'s</div>\n                <div class="countdown-label">SELF-DESTRUCTING...</div>\n              </div>\n              <button class="btn-destroy-now" id="destroyNowBtn">💥 DESTROY NOW</button>\n            </div>\n          '):"","\n        "),"\n      </div>\n    ")}},{key:"getDecryptedMessage",value:function(e,t){return e.encrypted?e.doubleEncrypted&&this.decryptKey&&this.decryptKey2?r.EncryptionService.decrypt2DE(e.message,this.decryptKey,this.decryptKey2):e.keypairEncrypted&&t.privateKey?r.EncryptionService.decryptWithPrivateKey(e.message,t.privateKey):this.decryptKey?r.EncryptionService.decryptMessage(e.message,this.decryptKey):"🔒 ENCRYPTED - ENTER KEY TO DECRYPT":e.message}},{key:"renderAttachment",value:function(e){if(e.type.startsWith("image/")){var t=e.name.startsWith("stego_");return'\n      <div class="attachment-box">\n        <div class="attachment-header">\n          ATTACHMENT: '.concat(t?"STEGO IMAGE 🔐":"IMAGE",'\n        </div>\n        <div class="attachment-image-wrap">\n          <img \n            src="').concat(e.data,'" \n            alt="').concat(e.name,'" \n            class="attachment-image-terminal"\n          />\n        </div>\n        <div class="attachment-name">').concat(e.name,"</div>\n        ").concat(t?'\n          <div class="stego-hint">\n            💡 This image contains a hidden message. Download and decode using the Stego tool.\n          </div>\n        ':"","\n      </div>\n    ")}return e.type.startsWith("audio/")?'\n        <div class="attachment-box">\n          <div class="attachment-header">ATTACHMENT: AUDIO</div>\n          <div class="attachment-audio-wrap">\n            <div class="audio-icon-terminal">🎤</div>\n            <div class="audio-name-terminal">'.concat(e.name,'</div>\n            <audio controls src="').concat(e.data,'" class="audio-player-terminal">\n              Audio not supported\n            </audio>\n          </div>\n        </div>\n      '):'\n        <div class="attachment-box">\n          <div class="attachment-header">ATTACHMENT: FILE</div>\n          <div class="attachment-file-wrap">\n            <div class="file-icon-terminal">📄</div>\n            <div class="file-details">\n              <div class="file-name-terminal">'.concat(e.name,'</div>\n              <div class="file-size-terminal">').concat((e.size/1024).toFixed(1),' KB</div>\n            </div>\n            <a \n              href="').concat(e.data,'" \n              download="').concat(e.name,'" \n              class="btn-download-terminal"\n            >\n              DOWNLOAD\n            </a>\n          </div>\n        </div>\n      ')}},{key:"attachEventListeners",value:function(){var e=this;this.container.querySelectorAll(".msg-list-item").forEach(function(t,n){t.addEventListener("click",function(){var n=parseInt(t.dataset.msgIdx);e.selectedMsg=e.messages[n],e.decryptKey="",e.decryptKey2="",e.viewingDestruct=null,e.countdown=null,e.countdownInterval&&clearInterval(e.countdownInterval),e.render(),e.attachEventListeners()})});var t=this.container.querySelector("#decryptKeyInput");t&&t.addEventListener("input",function(t){e.decryptKey=t.target.value,e.render(),e.attachEventListeners()});var n=this.container.querySelector("#decryptKey2Input");n&&n.addEventListener("input",function(t){e.decryptKey2=t.target.value,e.render(),e.attachEventListeners()});var r=this.container.querySelector("#viewDestructBtn");r&&r.addEventListener("click",function(){e.handleViewDestruct(e.selectedMsg)});var a=this.container.querySelector("#destroyNowBtn");a&&a.addEventListener("click",function(){e.destroyMessage(e.selectedMsg)})}},{key:"handleViewDestruct",value:function(e){var t=this;this.viewingDestruct=e.id,this.countdown=30;var n=30;this.render(),this.attachEventListeners(),this.countdownInterval=setInterval(function(){n-=1,t.countdown=n;var r=t.container.querySelector(".countdown-timer-large");r&&(r.textContent="".concat(n,"s")),n<=0&&t.destroyMessage(e)},1e3)}},{key:"destroyMessage",value:function(e){var t=this;this.countdownInterval&&clearInterval(this.countdownInterval),this.countdown=null;var n=this.state.getState("currentUser"),r=this.state.getState("users"),a=n.messages.map(function(t){return t.id===e.id?Oe(Oe({},t),{},{destructed:!0,message:"[DESTROYED]",read:!0}):t}),i=Oe(Oe({},n),{},{messages:a});this.state.setState("currentUser",i),r[n.username]=i,this.state.setState("users",r),this.state.persist(),this.selectedMsg=Oe(Oe({},e),{},{destructed:!0,message:"[DESTROYED]"}),this.viewingDestruct=null,this.messages=this.messages.map(function(n){return n.id===e.id?t.selectedMsg:n}),this.render(),this.attachEventListeners()}}],t&&ke(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function De(e){return De="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},De(e)}function Le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Ae(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Le(Object(n),!0).forEach(function(t){Re(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Le(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Re(e,t,n){return(t=Ue(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ie(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Ce(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ce(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Me(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function i(n,r,a,i){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return xe(u,"_invoke",function(n,r,a){var i,s,c,u=0,l=a||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return i=t,s=0,c=e,f.n=n,o}};function p(n,r){for(s=n,c=r,t=0;!d&&u&&!a&&t<l.length;t++){var a,i=l[t],p=f.p,v=i[2];n>3?(a=v===r)&&(c=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=e):i[0]<=p&&((a=n<2&&p<i[1])?(s=0,f.v=r,f.n=i[1]):p<v&&(a=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,f.n=v,s=0))}if(a||n>1)return o;throw d=!0,r}return function(a,l,v){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,v),s=l,c=v;(t=s<2?e:c)||!d;){i||(s?s<3?(s>1&&(f.n=-1),p(s,c)):f.n=c:f.v=c);try{if(u=2,i){if(s||(a="next"),t=i[a]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=i.return)&&t.call(i),s<2&&(c=TypeError("The iterator does not provide a '"+a+"' method"),s=1);i=e}else if((t=(d=f.n<0)?c:n.call(r,f))!==o)break}catch(t){i=e,s=1,c=t}finally{u=1}}return{value:t,done:d}}}(n,a,i),!0),u}var o={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(xe(t={},r,function(){return this}),t),d=u.prototype=s.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,xe(e,a,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=u,xe(d,"constructor",u),xe(u,"constructor",c),c.displayName="GeneratorFunction",xe(u,a,"GeneratorFunction"),xe(d),xe(d,a,"Generator"),xe(d,r,function(){return this}),xe(d,"toString",function(){return"[object Generator]"}),(Me=function(){return{w:i,m:f}})()}function xe(e,t,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}xe=function(e,t,n,r){function i(t,n){xe(e,t,function(e){return this._invoke(t,n,e)})}t?a?a(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},xe(e,t,n,r)}function Ne(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function Fe(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var i=e.apply(t,n);function o(e){Ne(i,r,a,o,s,"next",e)}function s(e){Ne(i,r,a,o,s,"throw",e)}o(void 0)})}}function Ke(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ue(r.key),r)}}function Ue(e){var t=function(e){if("object"!=De(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=De(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==De(t)?t:t+""}function Ge(e){return Ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ge(e)}function _e(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function i(n,r,a,i){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return Be(u,"_invoke",function(n,r,a){var i,s,c,u=0,l=a||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return i=t,s=0,c=e,f.n=n,o}};function p(n,r){for(s=n,c=r,t=0;!d&&u&&!a&&t<l.length;t++){var a,i=l[t],p=f.p,v=i[2];n>3?(a=v===r)&&(c=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=e):i[0]<=p&&((a=n<2&&p<i[1])?(s=0,f.v=r,f.n=i[1]):p<v&&(a=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,f.n=v,s=0))}if(a||n>1)return o;throw d=!0,r}return function(a,l,v){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,v),s=l,c=v;(t=s<2?e:c)||!d;){i||(s?s<3?(s>1&&(f.n=-1),p(s,c)):f.n=c:f.v=c);try{if(u=2,i){if(s||(a="next"),t=i[a]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=i.return)&&t.call(i),s<2&&(c=TypeError("The iterator does not provide a '"+a+"' method"),s=1);i=e}else if((t=(d=f.n<0)?c:n.call(r,f))!==o)break}catch(t){i=e,s=1,c=t}finally{u=1}}return{value:t,done:d}}}(n,a,i),!0),u}var o={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(Be(t={},r,function(){return this}),t),d=u.prototype=s.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,Be(e,a,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=u,Be(d,"constructor",u),Be(u,"constructor",c),c.displayName="GeneratorFunction",Be(u,a,"GeneratorFunction"),Be(d),Be(d,a,"Generator"),Be(d,r,function(){return this}),Be(d,"toString",function(){return"[object Generator]"}),(_e=function(){return{w:i,m:f}})()}function Be(e,t,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}Be=function(e,t,n,r){function i(t,n){Be(e,t,function(e){return this._invoke(t,n,e)})}t?a?a(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},Be(e,t,n,r)}function He(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Ye(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ye(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Ye(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function We(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function qe(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var i=e.apply(t,n);function o(e){We(i,r,a,o,s,"next",e)}function s(e){We(i,r,a,o,s,"throw",e)}o(void 0)})}}function $e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ze(r.key),r)}}function ze(e){var t=function(e){if("object"!=Ge(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Ge(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ge(t)?t:t+""}function Ve(e){return Ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ve(e)}function Qe(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function i(n,r,a,i){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return Je(u,"_invoke",function(n,r,a){var i,s,c,u=0,l=a||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return i=t,s=0,c=e,f.n=n,o}};function p(n,r){for(s=n,c=r,t=0;!d&&u&&!a&&t<l.length;t++){var a,i=l[t],p=f.p,v=i[2];n>3?(a=v===r)&&(c=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=e):i[0]<=p&&((a=n<2&&p<i[1])?(s=0,f.v=r,f.n=i[1]):p<v&&(a=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,f.n=v,s=0))}if(a||n>1)return o;throw d=!0,r}return function(a,l,v){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,v),s=l,c=v;(t=s<2?e:c)||!d;){i||(s?s<3?(s>1&&(f.n=-1),p(s,c)):f.n=c:f.v=c);try{if(u=2,i){if(s||(a="next"),t=i[a]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=i.return)&&t.call(i),s<2&&(c=TypeError("The iterator does not provide a '"+a+"' method"),s=1);i=e}else if((t=(d=f.n<0)?c:n.call(r,f))!==o)break}catch(t){i=e,s=1,c=t}finally{u=1}}return{value:t,done:d}}}(n,a,i),!0),u}var o={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(Je(t={},r,function(){return this}),t),d=u.prototype=s.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,Je(e,a,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=u,Je(d,"constructor",u),Je(u,"constructor",c),c.displayName="GeneratorFunction",Je(u,a,"GeneratorFunction"),Je(d),Je(d,a,"Generator"),Je(d,r,function(){return this}),Je(d,"toString",function(){return"[object Generator]"}),(Qe=function(){return{w:i,m:f}})()}function Je(e,t,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}Je=function(e,t,n,r){function i(t,n){Je(e,t,function(e){return this._invoke(t,n,e)})}t?a?a(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},Je(e,t,n,r)}function Xe(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function Ze(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var i=e.apply(t,n);function o(e){Xe(i,r,a,o,s,"next",e)}function s(e){Xe(i,r,a,o,s,"throw",e)}o(void 0)})}}function et(e){return function(e){if(Array.isArray(e))return tt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return tt(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?tt(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function nt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function rt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nt(Object(n),!0).forEach(function(t){at(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nt(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function at(e,t,n){return(t=ot(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function it(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ot(r.key),r)}}function ot(e){var t=function(e){if("object"!=Ve(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Ve(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ve(t)?t:t+""}new(function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.dbName="4WordDB",this.version=1,this.db=null},t=[{key:"init",value:(u=Fe(Me().m(function e(){var t=this;return Me().w(function(e){for(;;)if(0===e.n)return e.a(2,new Promise(function(e,n){var r=indexedDB.open(t.dbName,t.version);r.onerror=function(){return n(r.error)},r.onsuccess=function(){t.db=r.result,e(t.db)},r.onupgradeneeded=function(e){var t=e.target.result;if(!t.objectStoreNames.contains("messages")){var n=t.createObjectStore("messages",{keyPath:"id",autoIncrement:!0});n.createIndex("timestamp","timestamp",{unique:!1}),n.createIndex("type","type",{unique:!1}),n.createIndex("hash","hash",{unique:!0})}t.objectStoreNames.contains("contacts")||t.createObjectStore("contacts",{keyPath:"address"}).createIndex("name","name",{unique:!1}),t.objectStoreNames.contains("settings")||t.createObjectStore("settings",{keyPath:"key"})}}))},e)})),function(){return u.apply(this,arguments)})},{key:"saveMessage",value:(c=Fe(Me().m(function e(t,n){var r,a,i,o,s,c=this;return Me().w(function(e){for(;;)switch(e.n){case 0:if(this.db){e.n=1;break}return e.n=1,this.init();case 1:return a=JSON.stringify(t),e.n=2,K.encrypt(a,n);case 2:return i=e.v,e.n=3,K.hash(a);case 3:return o=e.v,s={encrypted:i.encrypted,timestamp:Date.now(),type:t.type||"text",hash:o,metadata:{algorithm:i.algorithm,layers:(null===(r=t.encryption)||void 0===r?void 0:r.layers)||1}},e.a(2,new Promise(function(e,t){var n=c.db.transaction(["messages"],"readwrite").objectStore("messages").add(s);n.onsuccess=function(){return e(n.result)},n.onerror=function(){return t(n.error)}}))}},e,this)})),function(e,t){return c.apply(this,arguments)})},{key:"getMessages",value:(s=Fe(Me().m(function e(t){var n,r,a,i,o,s,c,u,l,d,f=this,p=arguments;return Me().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=p.length>1&&void 0!==p[1]?p[1]:100,this.db){e.n=1;break}return e.n=1,this.init();case 1:return e.n=2,new Promise(function(e,t){var r=f.db.transaction(["messages"],"readonly").objectStore("messages").index("timestamp").openCursor(null,"prev"),a=[],i=0;r.onsuccess=function(t){var r=t.target.result;r&&i<n?(a.push({id:r.value.id,encrypted:r.value.encrypted,timestamp:r.value.timestamp,type:r.value.type,metadata:r.value.metadata}),i++,r.continue()):e(a)},r.onerror=function(){return t(r.error)}});case 2:r=e.v,a=[],i=Ie(r),e.p=3,i.s();case 4:if((o=i.n()).done){e.n=9;break}return s=o.value,e.p=5,e.n=6,K.decrypt(s.encrypted,t);case 6:c=e.v,u=JSON.parse(c),a.push(Ae(Ae({id:s.id},u),{},{storedAt:s.timestamp})),e.n=8;break;case 7:e.p=7,l=e.v,console.warn("Failed to decrypt message ".concat(s.id,":"),l.message);case 8:e.n=4;break;case 9:e.n=11;break;case 10:e.p=10,d=e.v,i.e(d);case 11:return e.p=11,i.f(),e.f(11);case 12:return e.a(2,a)}},e,this,[[5,7],[3,10,11,12]])})),function(e){return s.apply(this,arguments)})},{key:"searchMessages",value:(o=Fe(Me().m(function e(t,n){var r,a;return Me().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.getMessages(n,1e3);case 1:return r=e.v,a=t.toLowerCase(),e.a(2,r.filter(function(e){return e.content&&e.content.toLowerCase().includes(a)||e.recipientAddress&&e.recipientAddress.toLowerCase().includes(a)}))}},e,this)})),function(e,t){return o.apply(this,arguments)})},{key:"deleteMessage",value:(i=Fe(Me().m(function e(t){var n=this;return Me().w(function(e){for(;;)switch(e.n){case 0:if(this.db){e.n=1;break}return e.n=1,this.init();case 1:return e.a(2,new Promise(function(e,r){var a=n.db.transaction(["messages"],"readwrite").objectStore("messages").delete(t);a.onsuccess=function(){return e()},a.onerror=function(){return r(a.error)}}))}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"clearAllMessages",value:(a=Fe(Me().m(function e(){var t=this;return Me().w(function(e){for(;;)switch(e.n){case 0:if(this.db){e.n=1;break}return e.n=1,this.init();case 1:return e.a(2,new Promise(function(e,n){var r=t.db.transaction(["messages"],"readwrite").objectStore("messages").clear();r.onsuccess=function(){return e()},r.onerror=function(){return n(r.error)}}))}},e,this)})),function(){return a.apply(this,arguments)})},{key:"getStats",value:(r=Fe(Me().m(function e(){var t=this;return Me().w(function(e){for(;;)switch(e.n){case 0:if(this.db){e.n=1;break}return e.n=1,this.init();case 1:return e.a(2,new Promise(function(e,n){var r=t.db.transaction(["messages"],"readonly").objectStore("messages").count();r.onsuccess=function(){e({messageCount:r.result,dbName:t.dbName,version:t.version})},r.onerror=function(){return n(r.error)}}))}},e,this)})),function(){return r.apply(this,arguments)})},{key:"getAllRaw",value:(n=Fe(Me().m(function e(){var t,n=this,r=arguments;return Me().w(function(e){for(;;)switch(e.n){case 0:if(t=r.length>0&&void 0!==r[0]?r[0]:100,this.db){e.n=1;break}return e.n=1,this.init();case 1:return e.a(2,new Promise(function(e,r){var a=n.db.transaction(["messages"],"readonly").objectStore("messages").index("timestamp").openCursor(null,"prev"),i=[],o=0;a.onsuccess=function(n){var r=n.target.result;r&&o<t?(i.push(r.value),o++,r.continue()):e(i)},a.onerror=function(){return r(a.error)}}))}},e,this)})),function(){return n.apply(this,arguments)})}],t&&Ke(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r,a,i,o,s,c,u}()),new(function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.SIGNATURE="FW",this.VERSION=1},t=[{key:"chaosSequence",value:function(e,t){for(var n=[],r=this.seedToFloat(e),a=0;a<t;a++)r=3.99*r*(1-r),n.push(r);return n}},{key:"seedToFloat",value:function(e){for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return Math.abs(t%1e4)/1e4}},{key:"embedMessage",value:(a=qe(_e().m(function e(t,n,r){var a=this;return _e().w(function(e){for(;;)if(0===e.n)return e.a(2,new Promise(function(){var e=qe(_e().m(function e(i,o){var s,c,u,l,d,f,p;return _e().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,K.encrypt(n,r);case 1:s=e.v,c=JSON.stringify(s),u="".concat(a.SIGNATURE).concat(a.VERSION).concat(c.length.toString().padStart(8,"0")),l=u+c,d=new Image,(f=new FileReader).onload=function(){var e=qe(_e().m(function e(s){return _e().w(function(e){for(;;)switch(e.n){case 0:d.onload=qe(_e().m(function e(){var s,c,u,f,p,v,y,h,m,b,g,w,S,E,O;return _e().w(function(e){for(;;)switch(e.n){case 0:if(s=document.createElement("canvas"),c=s.getContext("2d"),s.width=d.width,s.height=d.height,c.drawImage(d,0,0),u=c.getImageData(0,0,s.width,s.height),f=u.data,p=a.chaosSequence(r,f.length/4),v=p.map(function(e,t){return{val:e,idx:t}}).sort(function(e,t){return e.val-t.val}).map(function(e){return e.idx}),y=3*Math.floor(f.length/4),!(8*l.length>y)){e.n=1;break}return o(new Error("Image too small for message")),e.a(2);case 1:h=0,m=He(l);try{for(m.s();!(b=m.n()).done;)for(g=b.value,w=g.charCodeAt(0),S=7;S>=0;S--)E=v[Math.floor(h/3)],f[O=4*E+h%3]=254&f[O]|w>>S&1,h++}catch(e){m.e(e)}finally{m.f()}c.putImageData(u,0,0),s.toBlob(function(e){i({blob:e,filename:"4word_stego_".concat(Date.now(),".png"),originalSize:t.size,newSize:e.size,messageLength:n.length})},"image/png");case 2:return e.a(2)}},e)})),d.src=s.target.result;case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),f.readAsDataURL(t),e.n=3;break;case 2:e.p=2,p=e.v,o(p);case 3:return e.a(2)}},e,null,[[0,2]])}));return function(t,n){return e.apply(this,arguments)}}()))},e)})),function(e,t,n){return a.apply(this,arguments)})},{key:"extractMessage",value:(r=qe(_e().m(function e(t,n){var r=this;return _e().w(function(e){for(;;)if(0===e.n)return e.a(2,new Promise(function(){var e=qe(_e().m(function e(a,i){var o,s;return _e().w(function(e){for(;;)switch(e.n){case 0:try{o=new Image,(s=new FileReader).onload=function(){var e=qe(_e().m(function e(t){return _e().w(function(e){for(;;)switch(e.n){case 0:o.onload=qe(_e().m(function e(){var t,s,c,u,l,d,f,p,v,y,h,m,b;return _e().w(function(e){for(;;)switch(e.n){case 0:if(t=document.createElement("canvas"),s=t.getContext("2d"),t.width=o.width,t.height=o.height,s.drawImage(o,0,0),c=s.getImageData(0,0,t.width,t.height),u=c.data,l=r.chaosSequence(n,u.length/4),d=l.map(function(e,t){return{val:e,idx:t}}).sort(function(e,t){return e.val-t.val}).map(function(e){return e.idx}),f=0,(v=(p=function(e){for(var t="",n=0;n<e;n++){for(var r=0,a=7;a>=0;a--){var i=d[Math.floor(f/3)];r|=(1&u[4*i+f%3])<<a,f++}t+=String.fromCharCode(r)}return t})(11)).startsWith(r.SIGNATURE)){e.n=1;break}return i(new Error("No hidden message found or wrong password")),e.a(2);case 1:if(y=parseInt(v.substring(3,11)),!(isNaN(y)||y<=0)){e.n=2;break}return i(new Error("Corrupted stego data")),e.a(2);case 2:return h=p(y),m=JSON.parse(h),e.n=3,K.decrypt(m,n);case 3:b=e.v,a({message:b,extractedAt:Date.now(),algorithm:m.algorithm});case 4:return e.a(2)}},e)})),o.src=t.target.result;case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),s.readAsDataURL(t)}catch(e){i(new Error("Extraction failed: ".concat(e.message)))}case 1:return e.a(2)}},e)}));return function(t,n){return e.apply(this,arguments)}}()))},e)})),function(e,t){return r.apply(this,arguments)})},{key:"getImageCapacity",value:(n=qe(_e().m(function e(t){return _e().w(function(e){for(;;)if(0===e.n)return e.a(2,new Promise(function(e){var n=new Image,r=new FileReader;r.onload=function(t){n.onload=function(){var t=n.width*n.height,r=Math.floor(3*t/8),a=r-11;e({width:n.width,height:n.height,totalPixels:t,maxMessageBytes:r,maxMessageChars:a,recommendedMaxChars:Math.floor(.8*a)})},n.src=t.target.result},r.readAsDataURL(t)}))},e)})),function(e){return n.apply(this,arguments)})}],t&&$e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r,a}());var st=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.container=t,this.state=n,this.commandService=new X(n),this.mediaRecorder=null,this.audioChunks=[],this.activeTab="feed",this.render()},t=[{key:"render",value:function(){var e=this.state.getState("currentUser"),t=this.state.getState("ui");this.container.innerHTML='\n      <div class="app-container" id="appContainer">\n        \x3c!-- Header --\x3e\n        <header class="terminal-header">\n          <div class="terminal-bar">\n            <div class="terminal-title">\n              <span class="terminal-prompt">4WORD</span>\n              <span class="terminal-user">'.concat(e.username,'</span>\n            </div>\n            <div class="terminal-controls">\n  <button class="terminal-btn ').concat(t.networkEnabled?"online":"offline",'" id="networkToggle">\n    <span class="status-dot"></span>\n    ').concat(t.networkEnabled?"ONLINE":"OFFLINE",'\n  </button>\n  <button class="terminal-btn" id="clearDataBtn">\n    🗑️ CLEAR DATA\n  </button>\n  <button class="terminal-btn logout" id="logoutBtn">\n    EXIT\n  </button>\n</div>\n          </div>\n        </header>\n\n        \x3c!-- Mobile Tab Navigation --\x3e\n        <nav class="mobile-nav">\n          <button class="nav-tab ').concat("feed"===this.activeTab?"active":"",'" id="tabFeed">\n            <span class="nav-icon">📡</span>\n            <span class="nav-label">FEED</span>\n          </button>\n          <button class="nav-tab ').concat("compose"===this.activeTab?"active":"",'" id="tabCompose">\n            <span class="nav-icon">✉️</span>\n            <span class="nav-label">COMPOSE</span>\n          </button>\n          <button class="nav-tab ').concat("commands"===this.activeTab?"active":"",'" id="tabCommands">\n            <span class="nav-icon">⚡</span>\n            <span class="nav-label">CMD</span>\n          </button>\n        </nav>\n\n        \x3c!-- Main Content --\x3e\n        <main class="terminal-content">\n          <section class="content-tab ').concat("feed"===this.activeTab?"active":"",'" id="feedTab">\n            ').concat(this.renderFeed(),'\n          </section>\n\n          <section class="content-tab ').concat("compose"===this.activeTab?"active":"",'" id="composeTab">\n            ').concat(this.renderCompose(),'\n          </section>\n\n          <section class="content-tab ').concat("commands"===this.activeTab?"active":"",'" id="commandsTab">\n            ').concat(this.renderCommands(),"\n          </section>\n        </main>\n      </div>\n    "),this.renderConversationsList(),this.attachAllListeners()}},{key:"attachAllListeners",value:function(){var e=this;this.attachListener("tabFeed","click",function(){console.log("Feed tab clicked"),e.activeTab="feed",e.render()}),this.attachListener("tabCompose","click",function(){console.log("Compose tab clicked"),e.activeTab="compose",e.render()}),this.attachListener("tabCommands","click",function(){console.log("Commands tab clicked"),e.activeTab="commands",e.render()}),this.attachListener("networkToggle","click",function(){console.log("Network toggle clicked");var t=e.state.getState("ui");e.state.setState("ui.networkEnabled",!t.networkEnabled),e.render()}),this.attachListener("logoutBtn","click",function(){console.log("Logout clicked"),confirm("Exit secure session?")&&e.state.setState("currentUser",null)}),this.attachListener("securityOpen","click",function(){console.log("Security Open clicked"),e.state.setState("ui.securityLevel","open"),e.render()}),this.attachListener("securityEncrypted","click",function(){console.log("Security Encrypted clicked"),e.state.setState("ui.securityLevel","encrypted"),e.render()}),this.attachListener("security2DE","click",function(){console.log("Security 2DE clicked"),e.state.setState("ui.securityLevel","2DE"),e.render()}),this.attachListener("privacyPublic","click",function(){console.log("Privacy Public clicked"),e.state.setState("ui.privacyLevel","public"),e.state.setState("ui.recipient","@everyone"),e.render()}),this.attachListener("privacyGroups","click",function(){console.log("Privacy Groups clicked"),e.state.setState("ui.privacyLevel","groups"),e.render()}),this.attachListener("privacyPrivate","click",function(){console.log("Privacy Private clicked"),e.state.setState("ui.privacyLevel","private"),e.render()}),this.attachListener("persistencePermanent","click",function(){console.log("Persistence Permanent clicked"),e.state.setState("ui.persistenceLevel","permanent"),e.render()}),this.attachListener("persistenceUndetermined","click",function(){console.log("Persistence Undetermined clicked"),e.state.setState("ui.persistenceLevel","undetermined"),e.render()}),this.attachListener("persistenceSelfDestruct","click",function(){console.log("Persistence Self-Destruct clicked"),e.state.setState("ui.persistenceLevel","self-destruct"),e.render()}),this.attachListener("recipient","input",function(t){e.state.setState("ui.recipient",t.target.value)}),this.attachListener("encryptKey","input",function(t){e.state.setState("ui.encryptKey",t.target.value)}),this.attachListener("encryptKey2","input",function(t){e.state.setState("ui.encryptKey2",t.target.value)}),this.attachListener("messageText","input",function(t){e.state.setState("ui.messageText",t.target.value)}),this.attachListener("sendBtn","click",function(){console.log("Send button clicked"),e.sendMessage()}),this.attachListener("inboxBtn","click",function(){console.log("Inbox button clicked"),e.viewInbox()}),this.attachListener("fileInput","change",function(t){console.log("File input changed"),e.handleFileAttach(t)}),this.attachListener("removeFile","click",function(){console.log("Remove file clicked"),e.state.setState("ui.attachedFile",null),e.render()}),this.attachListener("locationBtn","click",function(){console.log("Location button clicked"),e.shareLocation()}),this.attachListener("qrBtn","click",function(){console.log("QR button clicked"),e.generate2DEQR()}),this.attachListener("stegoBtn","click",function(){console.log("Stego button clicked"),e.openSteganography()});var t=document.getElementById("voiceBtn");t&&(t.addEventListener("mousedown",function(){console.log("Voice recording started"),e.startVoiceRecording()}),t.addEventListener("mouseup",function(){console.log("Voice recording stopped"),e.stopVoiceRecording()}),t.addEventListener("mouseleave",function(){e.stopVoiceRecording()})),this.attachListener("commandInput","input",function(t){e.state.setState("ui.commandInput",t.target.value)}),this.attachListener("commandInput","keypress",function(t){"Enter"===t.key&&(t.preventDefault(),e.executeCommand())}),this.attachListener("executeCmd","click",function(){console.log("Execute command clicked"),e.executeCommand()}),this.attachListener("clearResult","click",function(){console.log("Clear result clicked"),e.state.setState("ui.commandResult",""),e.render()}),this.attachListener("clearDataBtn","click",function(){confirm("⚠️ Clear all data? This will remove all messages and log you out.")&&(localStorage.clear(),alert("✓ Data cleared! Reloading..."),location.reload())})}},{key:"attachListener",value:function(e,t,n){var r=document.getElementById(e);r&&r.addEventListener(t,n)}},{key:"renderFeed",value:function(){return'\n      <div class="feed-container">\n        <div class="feed-header">\n          <h2 class="feed-title">TRANSMISSION FEED</h2>\n          <button class="btn-terminal btn-sm" id="inboxBtn">\n            📬 INBOX\n          </button>\n        </div>\n        <div class="conversations-list" id="conversationsList">\n          <div id="conversationsContainer"></div>\n        </div>\n      </div>\n    '}},{key:"renderCompose",value:function(){var e=this.state.getState("ui");return'\n      <div class="compose-container">\n        <div class="compose-header">\n          <h2 class="compose-title">NEW TRANSMISSION</h2>\n        </div>\n\n        <div class="compose-form">\n          <div class="terminal-input-group">\n            <label class="terminal-label">TO:</label>\n            <input \n              type="text" \n              id="recipient" \n              class="terminal-input" \n              placeholder="@username or @everyone"\n              value="'.concat(e.recipient,'"\n            />\n          </div>\n\n          <div class="settings-compact">\n            <div class="setting-row">\n              <label class="setting-label">SECURITY:</label>\n              <div class="btn-group-mini">\n                <button class="btn-mini ').concat("open"===e.securityLevel?"active":"",'" id="securityOpen">OPEN</button>\n                <button class="btn-mini ').concat("encrypted"===e.securityLevel?"active":"",'" id="securityEncrypted">ENC</button>\n                <button class="btn-mini ').concat("2DE"===e.securityLevel?"active":"",'" id="security2DE">2DE</button>\n              </div>\n            </div>\n\n            <div class="setting-row">\n              <label class="setting-label">PRIVACY:</label>\n              <div class="btn-group-mini">\n                <button class="btn-mini ').concat("public"===e.privacyLevel?"active":"",'" id="privacyPublic">PUB</button>\n                <button class="btn-mini ').concat("groups"===e.privacyLevel?"active":"",'" id="privacyGroups">GRP</button>\n                <button class="btn-mini ').concat("private"===e.privacyLevel?"active":"",'" id="privacyPrivate">PVT</button>\n              </div>\n            </div>\n\n            <div class="setting-row">\n              <label class="setting-label">PERSIST:</label>\n              <div class="btn-group-mini">\n                <button class="btn-mini ').concat("permanent"===e.persistenceLevel?"active":"",'" id="persistencePermanent">PERM</button>\n                <button class="btn-mini ').concat("undetermined"===e.persistenceLevel?"active":"",'" id="persistenceUndetermined">UNDET</button>\n                <button class="btn-mini ').concat("self-destruct"===e.persistenceLevel?"active":"",'" id="persistenceSelfDestruct">💣</button>\n              </div>\n            </div>\n          </div>\n\n          ').concat("encrypted"===e.securityLevel||"2DE"===e.securityLevel?'\n            <div class="terminal-input-group">\n              <label class="terminal-label">KEY:</label>\n              <input \n                type="password" \n                id="encryptKey" \n                class="terminal-input" \n                placeholder="encryption.key"\n                value="'.concat(e.encryptKey,'"\n              />\n            </div>\n          '):"","\n\n          ").concat("2DE"===e.securityLevel?'\n            <div class="terminal-input-group">\n              <label class="terminal-label">KEY2:</label>\n              <input \n                type="password" \n                id="encryptKey2" \n                class="terminal-input" \n                placeholder="secondary.key"\n                value="'.concat(e.encryptKey2||"",'"\n              />\n            </div>\n          '):"",'\n\n          <div class="terminal-input-group">\n            <label class="terminal-label">MESSAGE:</label>\n            <textarea \n              id="messageText" \n              class="terminal-textarea" \n              placeholder="type.your.message..."\n            >').concat(e.messageText,"</textarea>\n          </div>\n\n          ").concat(e.attachedFile?'\n            <div class="attached-file-terminal">\n              <span class="file-indicator">📎 '.concat(e.attachedFile.name,'</span>\n              <button class="btn-remove-terminal" id="removeFile">×</button>\n            </div>\n          '):"",'\n\n          <div class="compose-actions-grid">\n            <button class="btn-terminal btn-primary" id="sendBtn">\n              ▶ SEND\n            </button>\n\n            <label class="btn-terminal">\n              📎 FILE\n              <input type="file" id="fileInput" style="display: none;" />\n            </label>\n\n            <button class="btn-terminal ').concat(e.isRecording?"recording":"",'" id="voiceBtn">\n              🎤 ').concat(e.isRecording?"REC...":"VOICE",'\n            </button>\n\n            <button class="btn-terminal" id="locationBtn">\n              📍 LOC\n            </button>\n\n            <button class="btn-terminal" id="qrBtn">\n              📱 QR\n            </button>\n\n            <button class="btn-terminal" id="stegoBtn">\n              🖼️ STEGO\n            </button>\n          </div>\n        </div>\n      </div>\n    ')}},{key:"renderCommands",value:function(){var e=this.state.getState("ui"),t=this.state.getState("currentUser"),n=t.messages.filter(function(e){return!e.read&&(e.to===t.username||"@everyone"===e.to)}).length;return'\n      <div class="commands-container">\n        <div class="commands-header">\n          <h2 class="commands-title">TERMINAL</h2>\n        </div>\n\n        <div class="terminal-input-group">\n          <input \n            type="text" \n            id="commandInput" \n            class="command-input" \n            placeholder="help | users | status | showFriends"\n            value="'.concat(e.commandInput,'"\n          />\n          <button class="btn-execute" id="executeCmd">⏎</button>\n        </div>\n\n        ').concat(e.commandResult?'\n          <div class="command-output">\n            <div class="output-header">\n              <span class="output-label">OUTPUT:</span>\n              <button class="btn-close-terminal" id="clearResult">×</button>\n            </div>\n            <pre class="output-content">'.concat(e.commandResult,"</pre>\n          </div>\n        "):"",'\n\n        <div class="system-stats">\n          <div class="stat-line">\n            <span class="stat-label">FRIENDS:</span>\n            <span class="stat-value">').concat(t.friends.length,'</span>\n          </div>\n          <div class="stat-line">\n            <span class="stat-label">MESSAGES:</span>\n            <span class="stat-value">').concat(t.messages.length,'</span>\n          </div>\n          <div class="stat-line">\n            <span class="stat-label">UNREAD:</span>\n            <span class="stat-value ').concat(n>0?"highlight":"",'">').concat(n,'</span>\n          </div>\n          <div class="stat-line">\n            <span class="stat-label">PUBKEY:</span>\n            <span class="stat-value-small">').concat(t.publicKey?t.publicKey.slice(0,16)+"...":"N/A","</span>\n          </div>\n        </div>\n      </div>\n    ")}},{key:"renderConversationsList",value:function(){var e=this,t=document.getElementById("conversationsContainer");if(t){var n=this.getConversations();0!==n.length?(t.innerHTML=n.map(function(t,n){return'\n    <div class="conversation-card" id="conv_'.concat(n,'">\n      <div class="conversation-header-row">\n        <div class="conversation-from">\n          <span class="user-indicator">@</span>').concat(t.user.replace("@",""),'\n        </div>\n        <div class="conversation-time">').concat(j(t.lastMessage.timestamp),'</div>\n      </div>\n      <div class="conversation-preview-text">\n        ').concat(t.lastMessage.destructed?'<span class="destroyed-indicator">💥 DESTROYED</span>':t.lastMessage.selfDestruct?'<span class="destruct-indicator">💣 SELF-DESTRUCT</span>':e.truncateMessage(t.lastMessage.message,50),'\n      </div>\n      <div class="conversation-meta">\n        ').concat(t.lastMessage.encrypted?'<span class="badge-terminal">🔒</span>':"","\n        ").concat(t.unreadCount>0?'<span class="badge-terminal unread">'.concat(t.unreadCount," NEW</span>"):"","\n      </div>\n    </div>\n  ")}).join(""),n.forEach(function(t,n){var r=document.getElementById("conv_".concat(n));r&&r.addEventListener("click",function(){console.log("Conversation clicked:",t.user),e.openConversation(t.user)})})):t.innerHTML='<div class="no-conversations"><p>No transmissions detected</p></div>'}}},{key:"truncateMessage",value:function(e,t){return!e||e.length<=t?e||"":e.slice(0,t)+"..."}},{key:"getConversations",value:function(){var e=this.state.getState("currentUser"),t={};return e.messages.forEach(function(n){var r=n.from===e.username?n.to:n.from;"@everyone"!==r&&(t[r]||(t[r]={user:r,messages:[],lastMessage:n,unreadCount:0}),t[r].messages.push(n),n.read||n.to!==e.username||t[r].unreadCount++,new Date(n.timestamp)>new Date(t[r].lastMessage.timestamp)&&(t[r].lastMessage=n))}),Object.values(t).sort(function(e,t){return new Date(t.lastMessage.timestamp)-new Date(e.lastMessage.timestamp)})}},{key:"sendMessage",value:function(){console.log("sendMessage() called");var e=this.state.getState("ui"),t=this.state.getState("currentUser");if(e.recipient&&e.messageText){var n={id:Date.now().toString(36)+Math.random().toString(36).substr(2),from:t.username,to:e.recipient,message:e.messageText,security:e.securityLevel,privacy:e.privacyLevel,persistence:e.persistenceLevel,timestamp:(new Date).toISOString(),read:!1,destructed:!1,attachedFile:e.attachedFile?e.attachedFile.name:null,attachedFileData:e.attachedFile,encrypted:!1};"encrypted"===e.securityLevel&&e.encryptKey?(n.message=r.EncryptionService.encryptMessage(e.messageText,e.encryptKey),n.encrypted=!0):"2DE"===e.securityLevel&&e.encryptKey&&e.encryptKey2&&(n.message=r.EncryptionService.encrypt2DE(e.messageText,e.encryptKey,e.encryptKey2),n.encrypted=!0,n.doubleEncrypted=!0),("self-destruct"!==e.persistenceLevel||(n.selfDestruct=!0,confirm("💣 This message will self-destruct after reading. Continue?")))&&this.completeSendMessage(n)}else alert("⚠ Enter recipient and message")}},{key:"completeSendMessage",value:function(e){var t=this.state.getState("users"),n=this.state.getState("currentUser"),r=rt(rt({},n),{},{messages:[].concat(et(n.messages),[e])});if(t[n.username]=r,"@everyone"===e.to)Object.keys(t).forEach(function(r){r!==n.username&&(t[r]=rt(rt({},t[r]),{},{messages:[].concat(et(t[r].messages),[e])}))}),alert("✓ Broadcast transmitted");else{if(!t[e.to])return void alert("✗ Recipient not found");t[e.to]=rt(rt({},t[e.to]),{},{messages:[].concat(et(t[e.to].messages),[e])}),alert("✓ Message sent!")}this.state.setState("users",t),this.state.setState("currentUser",r),this.state.setState("ui.messageText",""),this.state.setState("ui.attachedFile",null),this.state.persist(),this.render()}},{key:"handleFileAttach",value:(o=Ze(Qe().m(function e(t){var n,r,a=this;return Qe().w(function(e){for(;;)switch(e.n){case 0:if(n=t.target.files[0]){e.n=1;break}return e.a(2);case 1:if(!(n.size>5242880)){e.n=2;break}return alert("⚠ File too large. Max 5MB"),e.a(2);case 2:(r=new FileReader).onload=function(e){var t={name:n.name,type:n.type,size:n.size,data:e.target.result};a.state.setState("ui.attachedFile",t),alert("✓ File attached: ".concat(n.name)),a.render()},r.readAsDataURL(n);case 3:return e.a(2)}},e)})),function(e){return o.apply(this,arguments)})},{key:"startVoiceRecording",value:(i=Ze(Qe().m(function e(){var t,n=this;return Qe().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!this.state.getState("ui").isRecording){e.n=1;break}return e.a(2);case 1:return e.p=1,e.n=2,navigator.mediaDevices.getUserMedia({audio:!0});case 2:t=e.v,this.mediaRecorder=new MediaRecorder(t),this.audioChunks=[],this.mediaRecorder.ondataavailable=function(e){n.audioChunks.push(e.data)},this.mediaRecorder.onstop=function(){var e=new Blob(n.audioChunks,{type:"audio/webm"}),r=new FileReader;r.onload=function(t){var r={name:"voice_".concat(Date.now(),".webm"),type:"audio/webm",size:e.size,data:t.target.result};n.state.setState("ui.attachedFile",r),alert("✓ Voice message recorded"),n.render()},r.readAsDataURL(e),t.getTracks().forEach(function(e){return e.stop()})},this.mediaRecorder.start(),this.state.setState("ui.isRecording",!0),this.render(),e.n=4;break;case 3:e.p=3,e.v,alert("⚠ Microphone access denied");case 4:return e.a(2)}},e,this,[[1,3]])})),function(){return i.apply(this,arguments)})},{key:"stopVoiceRecording",value:function(){this.state.getState("ui").isRecording&&(this.mediaRecorder&&"recording"===this.mediaRecorder.state&&this.mediaRecorder.stop(),this.state.setState("ui.isRecording",!1),this.render())}},{key:"shareLocation",value:function(){var e=this;navigator.geolocation?(alert("Getting location..."),navigator.geolocation.getCurrentPosition(function(t){var n=t.coords.latitude.toFixed(6),r=t.coords.longitude.toFixed(6),a="\n📍 Location: ".concat(n,", ").concat(r,"\nhttps://maps.google.com/?q=").concat(n,",").concat(r),i=e.state.getState("ui");e.state.setState("ui.messageText",i.messageText+a),alert("✓ Location added to message"),e.render()},function(e){alert("✗ Location unavailable: "+e.message)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})):alert("⚠ Geolocation not supported")}},{key:"generate2DEQR",value:(n=Ze(Qe().m(function e(){var t,n,a;return Qe().w(function(e){for(;;)switch(e.n){case 0:if((t=this.state.getState("ui")).messageText){e.n=1;break}return alert("⚠ Enter message first"),e.a(2);case 1:if(t.encryptKey){e.n=2;break}return alert("⚠ Enter encryption key first"),e.a(2);case 2:if(n="2DE"===t.securityLevel&&t.encryptKey2?r.EncryptionService.encrypt2DE(t.messageText,t.encryptKey,t.encryptKey2):r.EncryptionService.encryptMessage(t.messageText,t.encryptKey)){e.n=3;break}return alert("⚠ Encryption failed"),e.a(2);case 3:return e.n=4,we.generate(n,{color:{dark:"#0088cc",light:"#ffffff"},width:300});case 4:(a=e.v)?this.showModal("qr",{data:n,qrImage:a}):alert("⚠ QR generation failed");case 5:return e.a(2)}},e,this)})),function(){return n.apply(this,arguments)})},{key:"openSteganography",value:function(){this.showModal("steganography")}},{key:"viewInbox",value:function(){var e=this.state.getState("currentUser"),t=e.messages.filter(function(t){return t.to===e.username||"@everyone"===t.to});this.showModal("inbox",{messages:t})}},{key:"openConversation",value:function(e){var t=this.getConversations().find(function(t){return t.user===e});t&&this.showModal("conversation",{conversation:t})}},{key:"executeCommand",value:function(){var e=this.state.getState("ui");if(!e.commandInput)return this.state.setState("ui.commandResult","Enter a command. Try: help, users, status"),void this.render();var t=this.commandService.execute("$"+e.commandInput.replace(/^\$/,""));this.state.setState("ui.commandResult",t),this.state.setState("ui.commandInput",""),this.render()}},{key:"showModal",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=document.getElementById("modal-root");r.innerHTML="";var i=P("div","modal-overlay-terminal"),o=P("div","modal-terminal");i.appendChild(o);var s=P("div","modal-header-terminal"),c=P("h3","modal-title-terminal"),u=P("button","btn-close-modal","× CLOSE"),l="";"inbox"===e&&(l="📬 INBOX"),"qr"===e&&(l="📱 QR CODE"),"conversation"===e&&(l="💬 ".concat(n.conversation.user)),"steganography"===e&&(l="🖼️ STEGANOGRAPHY"),c.textContent=l,s.appendChild(c),s.appendChild(u),o.appendChild(s);var d=P("div","modal-content-terminal");"inbox"===e?new je(d,this.state,n.messages):"qr"===e?d.innerHTML='\n      <div class="qr-view-terminal">\n        <div class="qr-container">\n          <img src="'.concat(n.qrImage,'" alt="QR Code" class="qr-image" />\n        </div>\n        <p class="qr-description">Scan with compatible device to decrypt</p>\n        <div class="qr-data-box">\n          <div class="data-header">ENCRYPTED DATA:</div>\n          <pre class="data-content">').concat(n.data.slice(0,200)).concat(n.data.length>200?"...":"","</pre>\n        </div>\n      </div>\n    "):"conversation"===e?this.renderConversationModal(d,n.conversation):"steganography"===e&&new a.SteganographyView(d,this.state,function(e){t.state.setState("ui.attachedFile",e);var n=t.state.getState("ui");t.state.setState("ui.messageText",n.messageText+"\n[🖼️ ".concat(e.name,"]")),alert("✓ Stego image attached to message!"),t.closeModal(),t.render()}),o.appendChild(d),r.appendChild(i),u.addEventListener("click",function(){return t.closeModal()}),i.addEventListener("click",function(e){e.target===i&&t.closeModal()})}},{key:"renderConversationModal",value:function(e,t){var n=this.state.getState("currentUser"),r=t.messages.sort(function(e,t){return new Date(e.timestamp)-new Date(t.timestamp)}).map(function(e){var t=e.from===n.username;return'\n          <div class="msg-bubble '.concat(t?"sent":"received",'">\n            <div class="msg-meta">\n              ').concat(t?"YOU":e.from," › ").concat(j(e.timestamp),'\n            </div>\n            <div class="msg-text">\n              ').concat(e.destructed?"💥 DESTROYED":e.selfDestruct?"💣 SELF-DESTRUCT":e.encrypted?"🔒 ENCRYPTED":e.message,"\n            </div>\n          </div>\n        ")}).join("");e.innerHTML='\n      <div class="conversation-view">\n        '.concat(r||"<p>No messages</p>","\n      </div>\n    ")}},{key:"closeModal",value:function(){document.getElementById("modal-root").innerHTML=""}}],t&&it(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,i,o}(),ct=n(437);function ut(e){return ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ut(e)}function lt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,dt(r.key),r)}}function dt(e){var t=function(e){if("object"!=ut(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=ut(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ut(t)?t:t+""}var ft=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.canvas=t,this.scene=null,this.camera=null,this.renderer=null,this.particles=null,this.animationId=null,this.init()},t=[{key:"init",value:function(){var e=this;this.scene=new ct.Z58,this.camera=new ct.ubm(75,window.innerWidth/window.innerHeight,.1,1e3),this.camera.position.z=5,this.renderer=new ct.JeP({canvas:this.canvas,alpha:!0,antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setPixelRatio(window.devicePixelRatio),this.createParticles();var t=new ct.$p8(35071,.5);this.scene.add(t);var n=new ct.HiM(65535,1);n.position.set(5,5,5),this.scene.add(n),window.addEventListener("resize",function(){return e.onWindowResize()}),window.addEventListener("mousemove",function(t){return e.onMouseMove(t)}),this.animate()}},{key:"createParticles",value:function(){for(var e=new ct.LoY,t=[],n=[],r=0;r<5e3;r++){var a=50*(Math.random()-.5),i=50*(Math.random()-.5),o=50*(Math.random()-.5);t.push(a,i,o),n.push(.02*(Math.random()-.5),.02*(Math.random()-.5),.02*(Math.random()-.5))}e.setAttribute("position",new ct.qtW(t,3));var s=new ct.BH$({color:65535,size:.05,transparent:!0,opacity:.6,blending:ct.EZo});this.particles=new ct.ONl(e,s),this.particles.userData.velocities=n,this.scene.add(this.particles)}},{key:"onWindowResize",value:function(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}},{key:"onMouseMove",value:function(e){var t=e.clientX/window.innerWidth*2-1,n=-e.clientY/window.innerHeight*2+1;this.camera.position.x=2*t,this.camera.position.y=2*n,this.camera.lookAt(this.scene.position)}},{key:"animate",value:function(){var e=this;if(this.animationId=requestAnimationFrame(function(){return e.animate()}),this.particles){this.particles.rotation.x+=5e-4,this.particles.rotation.y+=.001;for(var t=this.particles.geometry.attributes.position.array,n=this.particles.userData.velocities,r=0;r<t.length;r+=3)t[r]+=n[r],t[r+1]+=n[r+1],t[r+2]+=n[r+2],Math.abs(t[r])>25&&(n[r]*=-1),Math.abs(t[r+1])>25&&(n[r+1]*=-1),Math.abs(t[r+2])>25&&(n[r+2]*=-1);this.particles.geometry.attributes.position.needsUpdate=!0}this.renderer.render(this.scene,this.camera)}},{key:"destroy",value:function(){var e=this;this.animationId&&cancelAnimationFrame(this.animationId),window.removeEventListener("resize",function(){return e.onWindowResize()}),this.renderer&&this.renderer.dispose()}}],t&&lt(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();const pt=JSON.parse('{"@alice":{"username":"@alice","passphraseHash":"demo_salt_alice:5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8","publicKey":"8f434346648f6b96df89dda901c5176b10a6d83961dd3c1ac88b59b2dc327aa4","privateKey":"5c4c4c62b67b6a8b9d9e8c7a5b4a3c2d1e0f9a8b7c6d5e4f3a2b1c0d9e8f7a6b","friends":["@bob"],"groups":[],"messages":[],"friendRequests":[],"groupInvites":[],"deadDrops":[],"createdAt":"2024-01-01T00:00:00.000Z"},"@bob":{"username":"@bob","passphraseHash":"demo_salt_bob:5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8","publicKey":"7e323245537e5a85ce78cca800b4065a0f95c72850cc2c0ab77a48a1cb216993","privateKey":"4b3b3b51a56a5979c8c8d7b6a4a9392b1c0e8f979a8b7c6d5e4f3a2b1c0d9e8f","friends":["@alice"],"groups":[],"messages":[],"friendRequests":[],"groupInvites":[],"deadDrops":[],"createdAt":"2024-01-01T00:00:00.000Z"}}');function vt(e){return vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vt(e)}function yt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ht(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yt(Object(n),!0).forEach(function(t){mt(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yt(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function mt(e,t,n){return(t=gt(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function bt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,gt(r.key),r)}}function gt(e){var t=function(e){if("object"!=vt(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=vt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==vt(t)?t:t+""}var wt=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.state=k,this.currentView=null,this.threeBackground=null,this.init()},t=[{key:"init",value:function(){var e=this,t=this.state.getState("users"),n=ht(ht({},pt),t);this.state.setState("users",n),this.state.restore(),setTimeout(function(){var t=document.getElementById("three-bg");t&&(e.threeBackground=new ft(t))},500),this.state.subscribe(function(t){"currentUser"===t.path&&e.renderApp()}),this.renderApp(),this.initSecurityFeatures()}},{key:"initSecurityFeatures",value:function(){var e=this;window.addEventListener("beforeunload",function(){e.state.setState("ui.encryptKey",""),e.state.setState("ui.encryptKey2","")}),document.addEventListener("visibilitychange",function(){document.hidden?console.log("App hidden - session paused"):console.log("App visible - session resumed")}),document.addEventListener("selectstart",function(e){e.target&&e.target.classList&&e.target.classList.contains("no-select")&&e.preventDefault()}),document.addEventListener("contextmenu",function(e){e.target&&e.target.classList&&e.target.classList.contains("no-context")&&e.preventDefault()})}},{key:"renderApp",value:function(){var e=document.getElementById("app"),t=this.state.getState("currentUser");e?this.currentView=t?new st(e,this.state):new q(e,this.state):console.error("App container not found")}}],t&&bt(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();document.addEventListener("DOMContentLoaded",function(){try{new wt,console.log("4WORD App initialized successfully")}catch(t){console.error("Failed to initialize app:",t);var e=document.getElementById("app");e&&(e.innerHTML='\n        <div style="display: flex; align-items: center; justify-content: center; min-height: 100vh; padding: 2rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">\n          <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 500px; text-align: center;">\n            <h1 style="color: #ff3b30; margin-bottom: 1rem;">⚠️ Initialization Error</h1>\n            <p style="color: #1c1e21; margin-bottom: 1rem;">Failed to start the application. Please try:</p>\n            <ul style="text-align: left; color: #65676b; margin-bottom: 1rem;">\n              <li>Clear browser cache and cookies</li>\n              <li>Refresh the page</li>\n              <li>Try in incognito/private mode</li>\n            </ul>\n            <button onclick="localStorage.clear(); location.reload();" style="background: #0088cc; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer;">\n              Clear Data & Reload\n            </button>\n            <p style="font-size: 12px; color: #8a8d91; margin-top: 1rem;">Error: '.concat(t.message,"</p>\n          </div>\n        </div>\n      "))}}),"undefined"!=typeof window&&(window.__4WORD_DEBUG__={version:"2.0.0",clearData:function(){localStorage.clear(),location.reload()},getState:function(){return console.log("Current state available in console"),k.getState()}})}},n={};function r(e){var a=n[e];if(void 0!==a)return a.exports;var i=n[e]={exports:{}};return t[e](i,i.exports,r),i.exports}r.m=t,e=[],r.O=(t,n,a,i)=>{if(!n){var o=1/0;for(l=0;l<e.length;l++){for(var[n,a,i]=e[l],s=!0,c=0;c<n.length;c++)(!1&i||o>=i)&&Object.keys(r.O).every(e=>r.O[e](n[c]))?n.splice(c--,1):(s=!1,i<o&&(o=i));if(s){e.splice(l--,1);var u=a();void 0!==u&&(t=u)}}return t}i=i||0;for(var l=e.length;l>0&&e[l-1][2]>i;l--)e[l]=e[l-1];e[l]=[n,a,i]},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={792:0};r.O.j=t=>0===e[t];var t=(t,n)=>{var a,i,[o,s,c]=n,u=0;if(o.some(t=>0!==e[t])){for(a in s)r.o(s,a)&&(r.m[a]=s[a]);if(c)var l=c(r)}for(t&&t(n);u<o.length;u++)i=o[u],r.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return r.O(l)},n=self.webpackChunk_4word=self.webpackChunk_4word||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var a=r.O(void 0,[96],()=>r(121));a=r.O(a)})();